<div class="game-container">
    <h1>Coin Bomb Game</h1>

    <!-- Login Screen for Anonymous Users (Fallback) -->
    <div *ngIf="!isPlayerNameSet" class="login-screen">
        <input type="text" [(ngModel)]="playerName" placeholder="Enter your name" class="name-input">
        <button (click)="startGame()">Start Playing</button>
        <p *ngIf="errorMessage" class="lose-msg">{{ errorMessage }}</p>
        <p class="auth-links">
            Want to save your scores? <a routerLink="/landing">Choose authentication option</a>
        </p>
    </div>

    <!-- Game HUD -->
    <div *ngIf="isPlayerNameSet" class="hud">
        <div class="stat">
            <span class="label">Player</span>
            <span class="value">{{ playerName }}</span>
        </div>
        <div class="stat">
            <span class="label">Level</span>
            <span class="value">{{ level }}</span>
        </div>
        <div class="stat">
            <span class="label">Score</span>
            <span class="value">{{ score }}</span>
        </div>
        <div class="stat">
            <span class="label">Lives</span>
            <span class="value hearts">
                <span *ngFor="let i of [].constructor(lives)">â¤ï¸</span>
            </span>
        </div>
        <div class="stat" *ngIf="authService.getUser()">
            <button (click)="logout()" class="btn btn-secondary">Logout</button>
        </div>
    </div>

    <div *ngIf="isPlayerNameSet" class="status-bar">
        <p *ngIf="isLoading">Loading...</p>

        <div *ngIf="!isLoading">
            <p *ngIf="gameStatus === 'IN_PROGRESS'">Find coins! Avoid bombs.</p>
            <p *ngIf="gameStatus === 'WON'" class="win-msg">ğŸ‰ Level Complete! ğŸ‰</p>
            <p *ngIf="gameStatus === 'LOST'" class="lose-msg">ğŸ’¥ Game Over! ğŸ’¥</p>
        </div>

        <button *ngIf="gameStatus === 'WON'" (click)="nextLevel()" class="next-level-btn">Next Level â¡ï¸</button>
        <button *ngIf="gameStatus === 'LOST'" (click)="restartGame()">Try Again ğŸ”„</button>
    </div>

    <div class="game-grid" *ngIf="grid && isPlayerNameSet">
        <div class="row" *ngFor="let row of grid; let x = index">
            <div class="square" *ngFor="let square of row; let y = index" (click)="onSquareClick(x, y)"
                [class.revealed]="square.revealed" [class.bomb]="square.content === 'Bomb'"
                [class.coin]="square.content === 'Coin'">
                <span *ngIf="square.revealed">
                    {{ square.content === 'Bomb' ? 'ğŸ’£' : (square.content === 'Coin' ? 'ğŸª™' : '') }}
                </span>
            </div>
        </div>
    </div>
</div>
